# draft-guide-ibmmq-jms-cqrs

Command query responsibility segregation (CQRS) microservices architectures

Start IBM MQ on Linux
```
docker pull icr.io/ibm-messaging/mq:latest

docker volume create qm1data

docker run \
  --env LICENSE=accept --env MQ_QMGR_NAME=QM1 \
  --volume qm1data:/mnt/mqm \
  --publish 1414:1414 --publish 9443:9443 \
  --detach \
  --env MQ_APP_PASSWORD=passw0rd --env MQ_ADMIN_PASSWORD=passw0rd \
  --rm \
  --name QM1 \
  icr.io/ibm-messaging/mq:latest
```

Navigate to the finish directory.
```
cd finish
```

Start the database
```
./scripts/startPostgres.sh
```

Build and install the models
```
mvn -pl models clean install
```

Start `inventory` service in dev mode:
```
mvn -pl inventory liberty:dev
```

Start `query` service in dev mode:
```
mvn -pl query liberty:dev
```

Start `command` service in dev mode:
```
mvn -pl command liberty:dev
```

Visit http://localhost:9080/openapi/ui/ or run following commands

Get
```
curl http://localhost:9080/inventory/systems
```

Post
```
curl -X POST 'http://localhost:9080/inventory/systems?heapSize=1000&hostname=localhost&javaVersion=17&osName=Linux'
```

Put
```
curl -X PUT 'http://localhost:9080/inventory/systems/localhost?heapSize=2000&javaVersion=21&osName=Linux'
```

Delete
```
curl -X DELETE 'http://localhost:9080/inventory/systems/localhost'
```

Tear Down

- stop all dev mode for the inventory, command, and query services
- stop database
```
cd finish
./scripts/stopPostgres.sh
```
- stop IBM MQ
```
docker stop QM1
docker volume remove qm1data
```

## Issues
- update not work well. Databse seems not picking up the update
- load inventory to cache when starting the inventory
- reduce the cache if possible