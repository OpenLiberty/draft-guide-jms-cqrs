// Copyright (c) 2024 IBM Corporation and others.
// Licensed under Creative Commons Attribution-NoDerivatives
// 4.0 International (CC BY-ND 4.0)
//   https://creativecommons.org/licenses/by-nd/4.0/
//
// Contributors:
//   IBM Corporation
:projectid: jms-cqrs
:page-layout: guide-multipane
:page-duration: 30 minutes
:page-releasedate: 2024-08-29
:page-description: Learn how to use Jakarta Messaging in CQRS architectural application with Liberty Messaging Server, Liberty Messaging Server Client, and IBM MQ.
:page-tags: ['microprofile', 'jakartaee']
:page-permalink: /guides/{projectid}
:imagesdir: /img/guide/{projectid}
:page-related-guides: ['jpa-intro', 'jakarta-websocket']
:common-includes: https://raw.githubusercontent.com/OpenLiberty/guides-common/prod
:source-highlighter: prettify
:page-seo-title: Implementing Command and Query Responsibility Segregation CQRS architectural application by using Jakarta Messaging
:page-seo-description: A getting started tutorial with examples on how to implement an application with Command and Query Responsibility Segregation CQRS architectural pattern by using Jakarta Messaging with Liberty Messaging Server, Liberty Messaging Server Client, and IBM MQ.
= Communication between services in CQRS architecture using Jakarta Messaging

Learn how to use Jakarta Messaging in CQRS architectural application with Liberty Messaging Server, Liberty Messaging Server Client, and IBM MQ.

Navigate to the finish directory.
```
cd finish
```

Start the database
```
./scripts/startPostgres.sh
```

Build and install the models
```
mvn -pl models clean install
```

Start `inventory` service in dev mode:
```
mvn -pl inventory liberty:dev
```

Start `query` service in dev mode:
```
mvn -pl query liberty:dev
```

Start `command` service in dev mode:
```
mvn -pl command liberty:dev
```

Visit http://localhost:9080 or try out http://localhost:9080/openapi/ui/ or

Get
```
curl http://localhost:9082/api/systems
```

Post
```
curl -X POST \
  http://localhost:9080/inventory/systems \
  -H 'accept: */*' \
  -H 'Content-Type: application/json' \
  -d '{ "id": 0, "hostname": "host4", "osName": "Mac", "javaVersion": "17", "heapSize": 1200 }'
```

Put
```
curl -X PUT \
  http://localhost:9080/inventory/systems/host4 \
  -H 'accept: */*' \
  -H 'Content-Type: application/json' \
  -d '{ "id": 0, "hostname": "host4", "osName": "Mac", "javaVersion": "22", "heapSize": 1110 }'
```

Delete
```
curl -X DELETE http://localhost:9080/inventory/systems/host4
```

Tear Down

- stop all dev mode for the inventory, command, and query services
- stop database
```
cd finish
./scripts/stopPostgres.sh
```

## Issues
- ...
